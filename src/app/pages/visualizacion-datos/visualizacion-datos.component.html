<main class="box">
  <div class="background-image" style="background-image: url(../assets/images/fondo_gallinas.jpg);"></div>
  <!--Imagen de fondo-->

  <!-- Inicio contenido -->
  <div id="mainBox" class="box">
    <nav>
      <button (click)="mostrarSeccion('ventas')">Ventas</button>
      <button (click)="mostrarSeccion('gastos')">Gastos</button>
      <button (click)="mostrarSeccion('graficas')">Gráficas</button>
    </nav>

    <div id="first-container" class="box">
      <a (click)="arrowBack()" id="arrowBack">
        <img src="../../../assets/ico/arrow-left.png" alt="">
      </a>
      <h1 class="label">{{granjaSeleccionada.name.toUpperCase()}}</h1>
      <div style="width: 30px;"></div>
    </div>
    <h2 class="label">{{galpon.name}}</h2>

    <!-- Tabla de Ventas -->
    <div id="ventas" class="box" *ngIf="mostrarVentas">
      <div id="ulGranjas" class="box">
        <h3 class="label">Ventas</h3>
        <input type="text" placeholder="Buscar en ventas..." (input)="filtrarVentas($event)">
        <h4 class="label">{{this.currentPageVentas + 1}}/{{this.ventasGalponGrupo.length}}</h4>
        <div [@fadeInOutFastWidth] class="box" id="arrows">
          <i [@fadeInOutFastWidth] *ngIf="this.currentPageVentas != 0"
            (click)="this.currentPageVentas = this.changePage(this.currentPageVentas,-1,this.ventasFiltradas.length)"
            class="fa-solid fa-arrow-left"></i>
          <i [@fadeInOutFastWidth] *ngIf="this.currentPageVentas != this.ventasGalponGrupo.length - 1"
            (click)="this.currentPageVentas = changePage(this.currentPageVentas,1,this.ventasFiltradas.length)"
            class="fa-solid fa-arrow-right"></i>
        </div>
        <div id="table">
          <table>
            <tbody>
              <tr class="encabezado">
                <th>id</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Cliente</th>
                <th>Tipo</th>
                <th>Cantidad</th>
                <th>Valor</th>
              </tr>
              <ng-container *ngFor="let venta of this.ventasFiltradas[this.currentPageVentas]">
                <tr *ngFor="let detalle of venta.detalle; let i = index" class="table-content">
                  <td *ngIf="i === 0" [attr.rowspan]="venta.detalle.length">{{ venta.id }}</td>
                  <td *ngIf="i === 0" [attr.rowspan]="venta.detalle.length">{{ venta.fecha.toDate() |
                    date:'dd/MMMM/yyyy':'es' }}</td>
                  <td *ngIf="i === 0" [attr.rowspan]="venta.detalle.length">{{ venta.fecha.toDate() | date:'hh:mma':'es'
                    }}</td>
                  <td *ngIf="i === 0" [attr.rowspan]="venta.detalle.length">{{ venta.cliente }}</td>
                  <td>{{ detalle.tipo }}</td>
                  <td>{{ detalle.cantidad | number }}</td>
                  <td *ngIf="i === 0" [attr.rowspan]="venta.detalle.length">{{ moneyFormat(venta.totalVenta) }}</td>
                </tr>
              </ng-container>
            </tbody>
          </table>
        </div>
        <p class="label"><strong>Total: {{moneyFormat(galpon.ventasTotales ?? 0)}}</strong></p>
      </div>
    </div>

    <!-- Tabla de Gastos -->
    <div id="gastos" class="box" *ngIf="mostrarGastos">
      <div id="ulGranjas" class="box">
        <h3 class="label">Gastos</h3>
        <input type="text" placeholder="Buscar en gastos..." (input)="filtrarGastos($event)">
        <div class="box" id="arrows">
          <i [@fadeInOutFastWidth] *ngIf="this.currentPageGastos != 0"
            (click)="this.currentPageGastos = changePage(this.currentPageGastos,-1,this.gastosFiltrados.length)"
            class="fa-solid fa-arrow-left"></i>
          <i [@fadeInOutFastWidth] *ngIf="this.currentPageGastos != this.gastosGalponGrupo.length - 1"
            (click)="this.currentPageGastos = changePage(this.currentPageGastos,1,this.gastosFiltrados.length)"
            class="fa-solid fa-arrow-right"></i>
        </div>
        <div id="table">
          <table>
            <tbody>
              <tr class="encabezado">
                <th>id</th>
                <th>Fecha</th>
                <th>Hora</th>
                <th>Valor</th>
                <th>Concepto</th>
              </tr>
              <tr *ngFor="let gasto of this.gastosFiltrados[this.currentPageGastos]" class="table-content">
                <td>{{ gasto.id }}</td>
                <td>{{gasto.fecha.toDate() | date:'dd/MMMM/yyyy':'es'}}</td>
                <td>{{gasto.fecha.toDate() | date:'hh:mm a':'es'}}</td>
                <td>{{moneyFormat(gasto.total)}}</td>
                <td>{{gasto.concepto}}</td>
              </tr>
            </tbody>
          </table>
        </div>
        <p class="label"><strong>Total: {{moneyFormat(galpon.gastosTotales ?? 0)}}</strong></p>
      </div>
    </div>

    <!-- Gráficas -->
    <div id="graficas" class="box" *ngIf="mostrarGraficas">
      <div id="chart-navigation">
        <i class="fa-solid fa-arrow-left" (click)="prevChart()"></i>
        <div class="chart-display">
          <h3 class="label">{{chartTitles[currentChartIndex]}}</h3>
          <div class="chart-box">
            <div class="select-container">
              <select *ngIf="currentChartIndex === 0" (change)="cambiarIntervalo($event)">
                <option value="por_cliente">Por Cliente</option>
                <option value="por_tipo">Por Tipo</option>
                <option value="diario">Diario</option>
                <option value="semanal">Semanal</option>
                <option value="mensual">Mensual</option>
                <option value="anual">Anual</option>
              </select>
              <!--<div class="date-filter-container" *ngIf="currentChartIndex !== 1">
                <label for="startDate">Desde: </label>
                <input type="date" id="startDate" [(ngModel)]="startDate" (change)="filterByDateRange()">
                <label for="endDate">Hasta: </label>
                <input type="date" id="endDate" [(ngModel)]="endDate" (change)="filterByDateRange()">
                <button (click)="filterLast7Days()">Últimos 7 días</button>
              </div>-->
            </div>
            <canvas id="chartCanvas"></canvas>
          </div>
        </div>
        <i class="fa-solid fa-arrow-right" (click)="nextChart()"></i>
      </div>
    </div>
    <app-popup-modal *ngIf="chargeIco"></app-popup-modal>
  </div>
</main>
